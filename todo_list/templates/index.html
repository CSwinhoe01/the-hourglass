{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container">

  <!-- Responsive header with login/logout -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-3 mb-3">
    <h1 class="h3 text-center text-md-start mb-2 mb-md-0">The Hourglass</h1>
    <div class="text-center text-md-end">
      {% if user.is_authenticated %}
        <a href="{% url 'account_logout' %}" class="btn btn-sm btn-primary">Logout</a>
      {% else %}
        <a href="{% url 'account_login' %}" class="btn btn-sm btn-primary">Login</a>
      {% endif %}
    </div>
  </div>

  <!-- Tables: stack on mobile, side-by-side on md+ -->
  <div class="row g-4 equalize">
    <div class="col-12 col-lg-6 d-flex">
      <div class="panel flex-fill d-flex flex-column">
        <!-- To-Do -->
        <h2>To-Do</h2>
        <div class="table-responsive flex-grow-1">
          <table class="table table-striped">
            <thead>
              <tr>
                <th><a href="?sort=due_date">Due Date</a></th>
                <th><a href="?sort=title">Title</a></th>
                <th><a href="?sort=status">Status</a></th>
                <th>Category</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for task in tasks %}
              {% if task.status != 'completed' %}
              <tr>
                <td>{{ task.due_date }}</td>
                <td>{{ task.title }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.category.name }}</td>
                <td>
                  <a href="{% url 'task_edit' task.pk %}" class="btn btn-sm btn-primary">Edit</a>
                  <a href="{% url 'task_delete' task.pk %}" class="btn btn-sm btn-danger">Delete</a>
                  <form action="{% url 'task_complete' task.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success">Complete</button>
                  </form>
                </td>
              </tr>
              {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- Centered Add icon -->
        <div class="text-center mt-3">
          <a href="{% url 'task_create' %}" aria-label="Create task" class="d-inline-block">
            <img src="{% static 'image/Add_icon.webp' %}" alt="Create Task" class="img-fluid mx-auto d-block" style="max-width:64px;height:auto;">
          </a>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6 d-flex">
      <div class="panel flex-fill d-flex flex-column">
        <!-- Completed -->
        <h2>Completed</h2>
        <div class="table-responsive flex-grow-1">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Due Date</th>
                <th>Title</th>
                <th>Status</th>
                <th>Category</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for task in tasks %}
              {% if task.status == 'completed' %}
              <tr>
                <td>{{ task.due_date }}</td>
                <td>{{ task.title }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.category.name }}</td>
                <td>
                  <a href="{% url 'task_edit' task.pk %}" class="btn btn-sm btn-primary">Edit</a>
                  <a href="{% url 'task_delete' task.pk %}" class="btn btn-sm btn-danger">Delete</a>
                </td>
              </tr>
              {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>

<style>
  /* Equalize heights only on >= 992px; below that, columns stack */
  @media (min-width: 992px) {
    .equalize > [class*="col-"] { display: flex; }
    .equalize .panel { display: flex; flex-direction: column; width: 100%; }
    .equalize .panel .table-responsive { flex: 1 1 auto; }
  }
</style>
{% endblock %}